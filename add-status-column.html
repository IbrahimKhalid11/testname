<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Status Column to Scorecard Results</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .sql-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .warning {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .button {
            background: #4299e1;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background: #3182ce;
        }
    </style>
</head>
<body>
    <h1>Add Status Column to Scorecard Results Table</h1>
    
    <div class="container">
        <h2>Instructions</h2>
        <p>This page helps you add a status column to your <code>scorecard_results</code> table in Supabase. This is needed to properly track the approval workflow.</p>
        
        <div class="warning">
            <strong>⚠️ Important:</strong> Before running this script, make sure you have a backup of your database or are working in a development environment.
        </div>
        
        <h3>Method 1: Using Supabase Dashboard (Recommended)</h3>
        <ol>
            <li>Go to your Supabase project dashboard</li>
            <li>Navigate to the SQL Editor</li>
            <li>Copy and paste the SQL code below</li>
            <li>Click "Run" to execute the script</li>
        </ol>
        
        <h3>Method 2: Using Supabase CLI</h3>
        <p>If you have Supabase CLI installed, you can run:</p>
        <div class="sql-code">supabase db push</div>
        
        <h3>SQL Script</h3>
        <div class="sql-code">-- Add status column to scorecard_results table
-- This script adds a status column to track the approval workflow

-- Add the status column with a default value
ALTER TABLE scorecard_results 
ADD COLUMN IF NOT EXISTS status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'submitted', 'approved'));

-- Update existing records to have appropriate status based on submitted_at
UPDATE scorecard_results 
SET status = CASE 
    WHEN submitted_at IS NOT NULL THEN 'submitted'
    ELSE 'draft'
END
WHERE status IS NULL OR status = 'draft';

-- Add an index on status for better performance
CREATE INDEX IF NOT EXISTS idx_scorecard_results_status ON scorecard_results(status);

-- Add a comment to document the status values
COMMENT ON COLUMN scorecard_results.status IS 'Status of the scorecard: draft, submitted, or approved';</div>
        
        <div class="success">
            <strong>✅ After running this script:</strong>
            <ul>
                <li>Your existing scorecard results will have their status set based on whether they were submitted</li>
                <li>New submissions will properly track their approval status</li>
                <li>The KPI data entry page will show the correct status and lock approved scorecards</li>
            </ul>
        </div>
    </div>
    
    <div class="container">
        <h2>What This Does</h2>
        <ul>
            <li><strong>Adds a status column</strong> with values: 'draft', 'submitted', 'approved'</li>
            <li><strong>Updates existing records</strong> to have 'submitted' status if they have a submitted_at timestamp</li>
            <li><strong>Adds an index</strong> for better query performance</li>
            <li><strong>Adds documentation</strong> to explain the status values</li>
        </ul>
    </div>
    
    <div class="container">
        <h2>Status Values Explained</h2>
        <ul>
            <li><strong>draft</strong>: Scorecard has data but hasn't been submitted yet</li>
            <li><strong>submitted</strong>: Scorecard has been submitted for approval but not yet approved</li>
            <li><strong>approved</strong>: Scorecard has been approved by HR and is locked for editing</li>
        </ul>
    </div>
    
    <script>
        // Add any interactive functionality here if needed
        console.log('Status column addition helper page loaded');
    </script>
</body>
</html> 